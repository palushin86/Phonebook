<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<f:view>
   <h:head><title>Телефонная книга</title></h:head>
   <h:body>
      <p:panel id="horizontal" header="Телефонная книга" toggleable="false" toggleOrientation="horizontal">

         <h:panelGrid columns="1" cellpadding="1" style="margin: 0 auto; text-align: center">
            <h:form id="searchForm">
               <h:panelGrid columns="4" cellpadding="10" style="margin: 0 auto">
                  <p:outputLabel value = "Поиск" />
                  <p:inputText value="#{contactViewBean.search}" onchange="#{contactViewBean.fetchContacts()}"/>
                  <p:commandLink action="#{contactViewBean.fetchContacts()}" update="recordsForm">
                     <h:graphicImage url="image/search.png" style="border:0; width: 25px" />
                  </p:commandLink>
                  <p:commandLink action="#{contactViewBean.cleanSearch()}" update="searchForm recordsForm">
                     <h:graphicImage url="image/clear.png" style="border:0; width: 25px" />
                  </p:commandLink>
               </h:panelGrid>
            </h:form>

            <h:form id="inputForm">
               <h:panelGrid id="inputPanel" columns="4"  cellpadding="10" style="margin: 0 auto">

                  <p:outputLabel value = "Фамилия" />
                  <p:inputText value="#{contactViewBean.lastName}" />
                  <p:outputLabel value = "Мобильный телефон" />
                  <p:inputText value="#{contactViewBean.mobilePhone}"  />
                  <p:outputLabel value = "Имя" />
                  <p:inputText value="#{contactViewBean.firstName}" />
                  <p:outputLabel value = "Рабочий телефон" />
                  <p:inputText value="#{contactViewBean.workPhone}" />
                  <p:outputLabel value = "Отчество" />
                  <p:inputText value="#{contactViewBean.middleName}"  />
                  <p:outputLabel value = "Домашний телефон" />
                  <p:inputText value="#{contactViewBean.homePhone}" />

                  <f:facet name = "footer">
                     <h:panelGroup style = "display:block; text-align:center">
                        <p:commandButton id = "edit_submit_btn"
                                         value = "Добавить запись"
                                         update="recordsForm inputForm" ajax="true"
                                         action="#{contactViewBean.addRecord()}" rendered="#{contactViewBean.editedRecord == null}"/>
                        <p:commandButton id = "edit_save_btn"
                                         value = "Сохранить запись"
                                         update="recordsForm inputForm" ajax="true"
                                         action="#{contactViewBean.saveRecord()}" rendered="#{contactViewBean.editedRecord != null}"/>
                        <p:commandButton id = "edit_cancel_btn"
                                         value = "Отмена"
                                         update="recordsForm inputForm" ajax="true"
                                         style="margin-left: 20px"
                                         action="#{contactViewBean.cancelEditing()}" rendered="#{contactViewBean.editedRecord != null}"/>
                     </h:panelGroup>
                  </f:facet>
               </h:panelGrid>
            </h:form>

            <h:form id="recordsForm">
               <p:dataTable id="contactsTable" widgetVar="contactsTable" var="contact"
                            value="#{contactViewBean.phones}" lazy="false"
                            emptyMessage="Нет записей"
                            cellspacing="1" cellpadding="1">

                  <p:column>
                     <f:facet name = "header">Фамилия</f:facet>
                     <h:outputText value="#{contact.lastName}"/>
                  </p:column>

                  <p:column>
                     <f:facet name = "header">Имя</f:facet>
                     <h:outputText value="#{contact.firstName}"/>
                  </p:column>

                  <p:column>
                     <f:facet name = "header">Отчество</f:facet>
                     <h:outputText value="#{contact.middleName}"/>
                  </p:column>

                  <p:column>
                     <f:facet name = "header">Мобильный телефон</f:facet>
                      <h:outputText value="#{contact.mobilePhoneNumber}"/>
                  </p:column>

                  <p:column>
                     <f:facet name = "header">Рабочий телефон</f:facet>
                      <h:outputText value="#{contact.workPhoneNumber}"/>
                  </p:column>

                  <p:column>
                     <f:facet name = "header">Домашний телефон</f:facet>
                      <h:outputText value="#{contact.homePhoneNumber}"/>
                  </p:column>

                  <p:column>
                      <h:commandLink action="#{contactViewBean.editRecord(contact)}">
                          <h:graphicImage url="image/edit.png" style="border:0; width: 25px"/>
                      </h:commandLink>
                  </p:column>

                  <p:column>
                     <h:commandLink action="#{contactViewBean.deleteRecord(contact)}">
                        <h:graphicImage url="image/delete.png" style="border:0; width: 25px" />
                     </h:commandLink>
                  </p:column>
               </p:dataTable>
            </h:form>

         </h:panelGrid>
      </p:panel>

      <p:panel toggleTitle="true" id="errorPanel" toggleable="true" closable="true"
               collapsed="false" rendered="#{flash.keep.errorDetails != null}">
         <f:facet name="header">
            <p:outputLabel value="Произошла ошибка" escape="true"/>
         </f:facet>
         <h:outputText value="#{flash.keep.errorDetails}"/>
      </p:panel>

   </h:body>
</f:view>
</html>